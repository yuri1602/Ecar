-- ════════════════════════════════════════════════════════════════════════════
-- ECar Fleet Management System - Clear All Data (Keep Only Admin)
-- Изчиства всички данни от базата, запазва само Admin профила
-- ════════════════════════════════════════════════════════════════════════════

-- Изключваме временно проверките на foreign keys за да можем да трием в правилния ред
SET session_replication_role = 'replica';

-- ============================================================================
-- СТЪПКА 1: Изтриваме всички нотификации
-- ============================================================================
DELETE FROM notifications;

-- ============================================================================
-- СТЪПКА 2: Изтриваме всички показания на одометър
-- ============================================================================
DELETE FROM odometer_readings;

-- ============================================================================
-- СТЪПКА 3: Изтриваме всички сесии на зареждане
-- ============================================================================
DELETE FROM charge_sessions;

-- ============================================================================
-- СТЪПКА 4: Изтриваме всички карти за зареждане
-- ============================================================================
DELETE FROM charge_cards;

-- ============================================================================
-- СТЪПКА 5: Изтриваме user-vehicle assignments
-- ============================================================================
DELETE FROM user_vehicles;

-- ============================================================================
-- СТЪПКА 6: Изтриваме всички автомобили
-- ============================================================================
DELETE FROM vehicles;

-- ============================================================================
-- СТЪПКА 7: Изтриваме всички тарифи
-- ============================================================================
DELETE FROM tariffs;

-- ============================================================================
-- СТЪПКА 8: Изтриваме всички зарядни станции
-- ============================================================================
DELETE FROM stations;

-- ============================================================================
-- СТЪПКА 9: Изтриваме всички потребители ОСВЕН admin
-- ============================================================================
DELETE FROM users WHERE id != '00000000-0000-0000-0000-000000000001';

-- Включваме обратно проверките на foreign keys
SET session_replication_role = 'origin';

-- ════════════════════════════════════════════════════════════════════════════
-- ИЗЧИСТВАНЕ ЗАВЪРШЕНО
-- ════════════════════════════════════════════════════════════════════════════

SELECT 
    'Изчистване завършено успешно!' as status,
    (SELECT COUNT(*) FROM users) as users_count,
    (SELECT COUNT(*) FROM vehicles) as vehicles_count,
    (SELECT COUNT(*) FROM stations) as stations_count,
    (SELECT COUNT(*) FROM tariffs) as tariffs_count,
    (SELECT COUNT(*) FROM charge_sessions) as sessions_count,
    (SELECT COUNT(*) FROM odometer_readings) as odometer_count,
    (SELECT COUNT(*) FROM notifications) as notifications_count;

-- Показваме оставащия Admin потребител
SELECT 
    id, 
    email, 
    full_name, 
    role, 
    is_active 
FROM users;
